
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Text ↔ Audio (EN ↔ TA) — Neon</title>
  <style>
    :root{
      --bg:#050914;
      --panel:#0a1226;
      --neon:#00c8ff; /* sky blue */
      --neon2:#6cfaff;
      --text:#e8f6ff;
      --muted:#a6c3d1;
      --accent:#9b59ff;
      --danger:#ff4d6d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% -10%, rgba(0,200,255,.08), transparent),
                  radial-gradient(1000px 800px at 120% 10%, rgba(155,89,255,.08), transparent),
                  var(--bg);
      color:var(--text);
      letter-spacing:.2px;
    }
    .container{
      max-width:1100px; margin:40px auto; padding:16px;
    }
    .title{
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    }
    .title h1{
      margin:0; font-size:clamp(22px,3vw,34px); font-weight:800; letter-spacing:.8px;
      text-shadow:0 0 10px rgba(108,250,255,.35), 0 0 22px rgba(0,200,255,.25);
    }
    .badge{font-size:12px; padding:6px 10px; border:1px solid rgba(108,250,255,.4); border-radius:999px; color:var(--neon2)}
    .grid{
      display:grid; grid-template-columns:1.2fr .8fr; gap:18px; align-items:start;
    }
    @media (max-width:900px){.grid{grid-template-columns:1fr;}}

    .card{
      background:linear-gradient(180deg, rgba(10,18,38,.8), rgba(10,18,38,.6));
      border:1px solid rgba(108,250,255,.15);
      border-radius:18px; padding:18px; box-shadow:0 10px 40px rgba(0,200,255,.06), inset 0 0 40px rgba(0,200,255,.03);
      position:relative; overflow:hidden;
    }
    .card:before{
      content:""; position:absolute; inset:-2px; border-radius:20px; padding:1px; background:
        linear-gradient(45deg, rgba(0,200,255,.35), rgba(155,89,255,.25));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; opacity:.35;
    }
    label{font-size:13px; color:var(--muted)}
    select, textarea, input[type="text"]{
      width:100%; background:#091326; color:var(--text); border:1px solid rgba(108,250,255,.2);
      border-radius:12px; padding:12px 14px; outline:none; font-size:14px;
      box-shadow:inset 0 0 20px rgba(0,200,255,.05);
    }
    textarea{min-height:160px; resize:vertical}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
    .stack{display:flex; gap:10px; flex-wrap:wrap}

    button{
      appearance:none; border:none; cursor:pointer; color:var(--text); font-weight:700; letter-spacing:.3px;
      padding:12px 16px; border-radius:14px; background:linear-gradient(180deg, rgba(0,200,255,.22), rgba(0,200,255,.12));
      border:1px solid rgba(108,250,255,.35); box-shadow:0 8px 30px rgba(0,200,255,.15), inset 0 0 30px rgba(0,200,255,.08);
      transition:.2s transform, .25s box-shadow, .25s filter;
    }
    button:hover{box-shadow:0 10px 38px rgba(0,200,255,.25), inset 0 0 40px rgba(0,200,255,.10)}
    button:active{transform:translateY(1px)}
    .btn-accent{background:linear-gradient(180deg, rgba(155,89,255,.32), rgba(155,89,255,.16)); border-color:rgba(155,89,255,.5)}
    .btn-danger{background:linear-gradient(180deg, rgba(255,77,109,.32), rgba(255,77,109,.14)); border-color:rgba(255,77,109,.5)}

    .hint{font-size:12px; color:var(--muted)}
    .meter{height:6px; border-radius:999px; background:#091326; border:1px solid rgba(108,250,255,.2); overflow:hidden}
    .bar{height:100%; width:0%; background:linear-gradient(90deg, var(--neon), var(--neon2)); box-shadow:0 0 12px var(--neon)}
    .audio-wrap{display:flex; gap:10px; align-items:center}
    audio{width:100%}
    .toggle{
      display:flex; gap:10px; background:#091326; padding:6px; border-radius:12px; border:1px solid rgba(108,250,255,.2)
    }
    .toggle button{flex:1; padding:10px; background:transparent; border:0; box-shadow:none; border-radius:10px}
    .toggle .active{background:rgba(0,200,255,.15); border:1px solid rgba(108,250,255,.35)}
    .footer{margin-top:14px; font-size:12px; color:var(--muted)}
    .warn{color:#ffd166}
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <h1>Text → Audio Converter • English ↔ தமிழ்</h1>
      <span class="badge">Neon UI</span>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <div>
            <label for="direction">Translate Direction</label>
            <select id="direction">
              <option value="en-ta">English → Tamil</option>
              <option value="ta-en">Tamil → English</option>
            </select>
          </div>
          <div>
            <label for="voiceGender">Voice (Gender)</label>
            <select id="voiceGender">
              <option value="female">Female</option>
              <option value="male">Male</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="rate">Speed</label>
            <input id="rate" type="range" min="0.5" max="1.6" step="0.1" value="1"/>
          </div>
          <div>
            <label for="pitch">Pitch</label>
            <input id="pitch" type="range" min="0.5" max="2" step="0.1" value="1"/>
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="inputText">Enter Text</label>
          <textarea id="inputText" placeholder="Type or paste your text here…"></textarea>
        </div>

        <div class="stack" style="margin-top:12px">
          <button id="btnTranslate">Translate</button>
          <button id="btnSpeak" class="btn-accent">Speak</button>
          <button id="btnStop" class="btn-danger">Stop</button>
        </div>

        <div style="margin-top:14px">
          <label for="outputText">Translated Text</label>
          <textarea id="outputText" placeholder="Translation will appear here…"></textarea>
        </div>

        <div style="margin-top:12px" class="hint">
          Tip: Voices depend on the device/browser. If Tamil voice is not available, use the built‑in download option below (add a free API key) to get MP3.
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div>
            <label for="voiceSelect">Available Browser Voices</label>
            <select id="voiceSelect"></select>
          </div>
          <div>
            <label>&nbsp;</label>
            <div class="toggle" role="tablist">
              <button id="filterAll" class="active">All</button>
              <button id="filterEN">EN</button>
              <button id="filterTA">TA</button>
            </div>
          </div>
        </div>

        <div style="margin-top:12px" class="hint">
          Browser TTS uses <code>SpeechSynthesis</code>. Choose a voice above or let the app pick by language + gender.
        </div>

        <div style="margin-top:16px">
          <div class="audio-wrap">
            <audio id="player" controls></audio>
            <button id="btnDownload">Download MP3</button>
          </div>
          <div class="meter" style="margin-top:10px"><div id="progress" class="bar"></div></div>
          <div class="footer">
            <div>Download uses a free TTS API if you add your key. <span class="warn">No key = no MP3.</span></div>
            <div style="margin-top:6px">
              <label for="apiKey">Optional: VoiceRSS API Key</label>
              <input id="apiKey" type="text" placeholder="Paste VoiceRSS API key here for downloadable audio"/>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:18px">
      <strong>How it works</strong>
      <ul>
        <li><b>Translate:</b> Free MyMemory API (rate‑limited) converts EN↔TA.</li>
        <li><b>Speak:</b> Browser SpeechSynthesis plays the translated text with your chosen voice, speed and pitch.</li>
        <li><b>Download:</b> If you add a free <a href="https://www.voicerss.org/" target="_blank">VoiceRSS</a> API key, click <i>Download MP3</i> to save audio (English + Tamil supported by VoiceRSS as <code>en-us</code> / <code>ta-in</code>). Gender depends on the selected voice name.</li>
      </ul>
      <div class="hint">Note: Free services have limits. For production, plug a robust TTS provider (e.g., ElevenLabs, Azure, Amazon Polly).</div>
    </div>
  </div>

<script>
  // --- Utilities ---
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const inputEl = $('#inputText');
  const outputEl = $('#outputText');
  const directionEl = $('#direction');
  const voiceGenderEl = $('#voiceGender');
  const voiceSelectEl = $('#voiceSelect');
  const player = $('#player');
  const progressBar = $('#progress');
  const rateEl = $('#rate');
  const pitchEl = $('#pitch');
  const apiKeyEl = $('#apiKey');

  // --- Voice Management ---
  let allVoices = [];
  function loadVoices(){
    allVoices = speechSynthesis.getVoices();
    populateVoiceList();
  }
  function populateVoiceList(filter = 'all'){
    const current = voiceSelectEl.value;
    voiceSelectEl.innerHTML = '';
    const filtered = allVoices.filter(v => {
      if(filter==='en') return v.lang.toLowerCase().startsWith('en');
      if(filter==='ta') return v.lang.toLowerCase().startsWith('ta');
      return true;
    });
    filtered.forEach(v => {
      const opt = document.createElement('option');
      opt.value = v.name;
      opt.textContent = `${v.name} — ${v.lang}${v.localService? ' (local)': ''}`;
      voiceSelectEl.appendChild(opt);
    });
    if(current){ voiceSelectEl.value = current; }
  }
  window.speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  // Toggle filters
  const setFilterBtn = (btn) => {
    $$('.toggle button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  $('#filterAll').onclick = (e)=>{ setFilterBtn(e.target); populateVoiceList('all'); };
  $('#filterEN').onclick = (e)=>{ setFilterBtn(e.target); populateVoiceList('en'); };
  $('#filterTA').onclick = (e)=>{ setFilterBtn(e.target); populateVoiceList('ta'); };

  // --- Translation ---
  async function translateText(text, dir){
    const [from,to] = dir==='en-ta' ? ['en','ta'] : ['ta','en'];
    // MyMemory free translate
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Translation API error');
    const data = await res.json();
    const translated = data?.responseData?.translatedText || '';
    return translated;
  }

  $('#btnTranslate').addEventListener('click', async ()=>{
    const text = inputEl.value.trim();
    if(!text) return;
    setProgress(20);
    try{
      const out = await translateText(text, directionEl.value);
      outputEl.value = out;
      setProgress(100);
      setTimeout(()=>setProgress(0), 600);
    }catch(err){
      console.error(err);
      alert('Translate failed. Try again.');
      setProgress(0);
    }
  });

  // --- Speak (Browser TTS) ---
  function pickVoiceFor(langPref, genderPref){
    // Try exact language first
    let candidates = allVoices.filter(v=>v.lang.toLowerCase().startsWith(langPref));
    // Try gender hint by common name patterns
    if(genderPref==='female'){
      candidates = candidates.filter(v => /(female|woman|siri|zira|linda|susan|joanna|amy|ariel|padma|asha)/i.test(v.name)) || candidates;
    } else {
      candidates = candidates.filter(v => /(male|man|david|mark|matthew|brian|raj|arun|veer)/i.test(v.name)) || candidates;
    }
    // Fallback to any voice
    return candidates[0] || allVoices[0];
  }

  function speak(text, lang, gender){
    if(!('speechSynthesis' in window)){
      return alert('SpeechSynthesis not supported in this browser.');
    }
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const chosen = voiceSelectEl.value
      ? allVoices.find(v=>v.name===voiceSelectEl.value)
      : pickVoiceFor(lang, gender);
    if(chosen){
      u.voice = chosen;
      u.lang = chosen.lang;
    } else {
      u.lang = lang;
    }
    u.rate = parseFloat(rateEl.value);
    u.pitch = parseFloat(pitchEl.value);
    u.onstart = ()=> setProgress(35);
    u.onend = ()=> { setProgress(100); setTimeout(()=>setProgress(0), 600); };
    u.onerror = (e)=> { console.error(e); alert('TTS error. Try a different voice.'); setProgress(0); };
    speechSynthesis.speak(u);
  }

  $('#btnSpeak').addEventListener('click', ()=>{
    const text = (outputEl.value.trim() || inputEl.value.trim());
    if(!text) return;
    const langPref = directionEl.value === 'en-ta' ? 'ta' : 'en';
    const gender = voiceGenderEl.value;
    speak(text, langPref, gender);
  });

  $('#btnStop').addEventListener('click', ()=> speechSynthesis.cancel());

  // --- Download via VoiceRSS (requires user API key) ---
  async function downloadTTS(text){
    const key = apiKeyEl.value.trim();
    if(!key){
      alert('Add your free VoiceRSS API key to download MP3.');
      return;
    }
    const dir = directionEl.value;
    const lang = dir==='en-ta' ? 'ta-in' : 'en-us';
    // Choose a default voice name per language & gender (depends on provider availability)
    const gender = voiceGenderEl.value;
    // Common names on VoiceRSS: en-us (Linda=female, John=male). Tamil usually uses default voice; omit name if not supported.
    let voiceName = '';
    if(lang==='en-us') voiceName = (gender==='female') ? 'Linda' : 'John';
    // Build API URL
    const params = new URLSearchParams({
      key,
      src: text,
      hl: lang,
      r: '0', // rate
      c: 'mp3', // codec
      f: '44khz_16bit_stereo'
    });
    if(voiceName) params.append('v', voiceName);

    const url = `https://api.voicerss.org/?${params.toString()}`;
    setProgress(40);
    const res = await fetch(url);
    const blob = await res.blob();
    // VoiceRSS returns text/plain on error
    if(blob.type.startsWith('text')){
      const msg = await blob.text();
      setProgress(0);
      alert('Download failed: '+ msg);
      return;
    }
    const filename = `tts_${Date.now()}.mp3`;
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a); a.click(); a.remove();
    setProgress(100); setTimeout(()=>setProgress(0), 600);
    // Also load into the player
    player.src = URL.createObjectURL(blob);
  }

  $('#btnDownload').addEventListener('click', async ()=>{
    const text = (outputEl.value.trim() || inputEl.value.trim());
    if(!text) return;
    try{ await downloadTTS(text); }catch(e){ console.error(e); alert('Download error.'); setProgress(0);} 
  });

  // --- Progress UI ---
  function setProgress(p){ progressBar.style.width = `${p}%`; }
</script>
</body>
</html>
